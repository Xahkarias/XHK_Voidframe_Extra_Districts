
## MBRAIN
########################################################################
xhk_frameworld_mbrain_0 = {
	entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"

	potential = { always = no }

	outliner_trigger = {
		exists = owner
		NOT = { has_megastructure_flag = giga_outliner_hidden_by_@owner }
	}
}

xhk_frameworld_mbrain_1 = {
	entity = "matrioshka_brain_01_entity"
	construction_entity = "matrioshka_brain_01_entity"
	portrait = "GFX_megastructure_construction_background"

	upgrade_from = { xhk_frameworld_mbrain_0 }
	outliner_trigger = {
		exists = owner
		NOT = { has_megastructure_flag = giga_outliner_hidden_by_@owner }
	}
	build_time = 2700
	resources = {
		category = megastructures
		cost = { alloys = 50000 }
		upkeep = { energy = 10 }
	}

	potential = { NOT = { has_global_flag = matrioshka_brain_disabled } }
	possible = { from = {
        has_gigastructural_constructs = yes
        has_technology = giga_tech_matrioshka_brain_1
    } }

	ai_weight = { factor = 10 } # If we can build it, we will build it
	on_build_complete = {
		save_event_target_as = giga_system
		fromfrom.planet = { save_event_target_as = giga_planet }
		from = { country_event = { id = giga_dialog.502 } }	# Notification
	}
}

xhk_frameworld_mbrain_2 = {
	entity = "matrioshka_brain_01_entity"
	construction_entity = "matrioshka_brain_01_entity"
	portrait = "GFX_megastructure_construction_background"

	upgrade_from = { xhk_frameworld_mbrain_1 }

	build_time = 5000
	resources = {
		category = megastructures
		cost = { alloys = 50000 }
		upkeep = { energy = 800 }
	}

	potential = { NOT = { has_global_flag = matrioshka_brain_disabled } }
	possible = { from = {
        has_gigastructural_constructs = yes
        has_technology = giga_tech_matrioshka_brain_1
    } }

	ai_weight = { factor = 10 } # If we can build it, we will build it
	on_build_complete = {
		save_event_target_as = giga_system
		fromfrom.planet = { save_event_target_as = giga_planet }
		from = { 
			set_country_flag = has_built_or_repaired_megastructure
			set_country_flag = has_built_or_repaired_gigastructure
			country_event = { id = xhk_voidframe_notif.001 } # Notification
		}	

		create_ambient_object = {
			type = giga_voidframe_mbrain_xhk
			location = fromfrom.planet
			use_3d_location = yes
			entity_face_object = fromfrom.planet
		}

		remove_megastructure = fromfrom

		random_system_planet = {
			limit = {
				giga_is_frame_world = yes
			}
			add_deposit = xhk_voidframe_mbrain
			set_planet_flag = xhk_voidframe_mbrain
			validate_planet_buildings_and_districts = yes
			remove_planet_flag = frameworld_upgrade
		}
	}
}

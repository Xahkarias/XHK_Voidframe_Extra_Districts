### ENCLAVES
###########################################################################################################

# 100 deg, 50 dist
xhk_extraframe_add_enclave_curator = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_curator }
		exists = event_target:curator_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:curator_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:curator_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_curator_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_curator

			star = {
				event_target:curator_enclave_country = {
					create_fleet = {
						name = "NAME_Curator_Alpha_Enclave"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Curator_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 100
								distance = 50
							}
						}
					}
				}
				this.solar_system = {
					save_global_event_target_as = curator_enclave_system
					set_star_flag = enclave
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 80 deg, 50 dist
xhk_extraframe_add_enclave_artisan = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_artisan }
		exists = event_target:artist_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:artist_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:artist_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_artisan_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_artisan

			star = {
				event_target:artist_enclave_country = {
					create_fleet = {
						name = "NAME_Ars_Artem"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Artist_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 80
								distance = 50
							}
							set_fleet_flag = artist_enclave_station
						}
					}
				}
				this.solar_system = {
					save_global_event_target_as = artisan_enclave_system
					set_star_flag = enclave
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 280 deg, 50 dist
xhk_extraframe_add_enclave_xuracorp = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_xuracorp }
		exists = event_target:xuracorp_country
		is_planet_class = pc_giga_frameworld
		event_target:xuracorp_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:xuracorp_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_xuracorp_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_xuracorp

			star = {
				event_target:xuracorp_country = {
					create_fleet = {
						name = "NAME_XuraCorp_HQ"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Trader_Enclave_Station"
								graphical_culture = prev
							}
							set_location = {
								target = prevprev
								angle = 280
								distance = 50
							}
							set_fleet_flag = trader_enclave_station
						}
					}
				}
				this.solar_system = {
					set_star_flag = xuracorp_enclave_system
					set_star_flag = enclave
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 275 deg, 50 dist
xhk_extraframe_add_enclave_riggian = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_riggian }
		exists = event_target:riggan_country
		is_planet_class = pc_giga_frameworld
		event_target:riggan_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:riggan_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_riggian_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_riggian

			star = {
				event_target:riggan_country = {
					create_fleet = {
						name = "NAME_Grand_Bazaar"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Trader_Enclave_Station"
								graphical_culture = prev
							}
							set_location = {
								target = prevprev
								angle = 275
								distance = 50
							}
							set_fleet_flag = trader_enclave_station
						}
					}
				}
				this.solar_system = {
					set_star_flag = enclave
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 290 deg, 50 dist
xhk_extraframe_add_enclave_muutagan = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_muutagan }
		exists = event_target:muutagan_country
		is_planet_class = pc_giga_frameworld
		event_target:muutagan_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:muutagan_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_muutagan_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_muutagan

			star = {
				event_target:muutagan_country = {
					create_fleet = {
						name = "NAME_Muutag_Station"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Trader_Enclave_Station"
								graphical_culture = prev
							}
							set_location = {
								target = prevprev
								angle = 290
								distance = 50
							}
							set_fleet_flag = trader_enclave_station
						}
					}
				}
				this.solar_system = {
					set_star_flag = enclave
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 285 deg, 50 dist
xhk_extraframe_add_enclave_museum = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_museum }
		exists = event_target:MYH_museum_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:MYH_museum_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:MYH_museum_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_museum_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_museum

			star = {
				event_target:MYH_museum_enclave_country = {
					create_fleet = {
						name = "NAME_Archivist_Ship"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Archivist_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 285
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 285 deg, 50 dist
# almost duplicate of above, they should never spawn together
xhk_extraframe_add_enclave_museum_forgotten_hist = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_museum }
		exists = event_target:AAA_museum_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:AAA_museum_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:AAA_museum_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_museum_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_museum

			star = {
				event_target:AAA_museum_enclave_country = {
					create_fleet = {
						name = "NAME_Archivista_Enclave_Station"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Archivista_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 285
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 295 deg, 50 dist
xhk_extraframe_add_enclave_garden = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_garden }
		exists = event_target:MYH_garden_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:MYH_garden_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:MYH_garden_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_garden_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_garden

			star = {
				event_target:MYH_garden_enclave_country = {
					create_fleet = {
						name = "NAME_Gardener_Ship"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Gardener_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 295
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 300 deg, 50 dist
xhk_extraframe_add_enclave_lawyer = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_lawyer }
		exists = event_target:MYH_lawyer_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:MYH_lawyer_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:MYH_lawyer_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_lawyer_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_lawyer

			star = {
				event_target:MYH_lawyer_enclave_country = {
					create_fleet = {
						name = "NAME_Lawyer_Ship"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Lawyer_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 300
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 305 deg, 50 dist
xhk_extraframe_add_enclave_exo = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_exo }
		exists = event_target:MYH_exo_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:MYH_exo_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:MYH_exo_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_exo_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_exo

			star = {
				event_target:MYH_exo_enclave_country = {
					create_fleet = {
						name = "NAME_Exo_Ship_1"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Exo_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 305
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 310 deg, 50 dist
xhk_extraframe_add_enclave_hive = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_hive }
		exists = event_target:ne_hive_country
		is_planet_class = pc_giga_frameworld
		event_target:ne_hive_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:ne_hive_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_hive_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_hive

			star = {
				event_target:ne_hive_country = {
					create_fleet = {
						name = "NAME_NEHIV_Fleet"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_NEHIV_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 310
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 315 deg, 50 dist
xhk_extraframe_add_enclave_drg = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_drg }
		exists = event_target:ne_drg_country
		is_planet_class = pc_giga_frameworld
		event_target:ne_drg_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:ne_drg_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_drg_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_drg

			star = {
				event_target:ne_drg_country = {
					create_fleet = {
						name = "NAME_NEDRG_Fleet_3"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_NEDRG_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 315
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 320 deg, 50 dist
xhk_extraframe_add_enclave_mach = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_mach }
		exists = event_target:ne_machine_country
		is_planet_class = pc_giga_frameworld
		event_target:ne_machine_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:ne_machine_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_mach_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_mach

			star = {
				event_target:ne_machine_country = {
					create_fleet = {
						name = "NAME_NEMAC_Fleet"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_NEMAC_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 320
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}


### AMBIENT STRUCTURES
###########################################################################################################

# ang 270 dis 50
xhk_extraframe_add_think_tank = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_think_tank

	prerequisites = {
		tech_science_nexus
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_think_tank }
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_vanilla_nexus_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_vanilla_nexus value < giga_vanilla_nexus_cap }
				}
			}
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_think_tank_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_think_tank

			from = {
				set_timed_country_flag = { flag = has_recently_built_think_tank years = 20 }
				set_country_flag = built_think_tank
				change_variable = { which = giga_current_vanilla_nexus value = 1 }
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_think_tank_0
						planet = this.star
						orbit_distance = 50 
						orbit_angle = 270
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

# ang 110 dis 30
xhk_extraframe_add_strat_coord = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_strat_coord

	prerequisites = {
		tech_strategic_coordination
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_mega_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_strat_coord }
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_vanilla_strategic_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_vanilla_strategic value < giga_vanilla_strategic_cap }
				}
			}
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_strat_coord_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_strat_coord

			from = {
				set_timed_country_flag = { flag = has_recently_built_strategic_coordination_center years = 20 }
				set_country_flag = built_strategic_coordination_center_site
				change_variable = { which = giga_current_vanilla_strategic value = 1 }
			}	

			from = {
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_stratcoord_0
						orbit_distance = 5 
						orbit_angle = 145
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

# ang 210 dis 65
xhk_extraframe_add_sentry= {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_sentry

	prerequisites = {
		tech_sentry_array
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 3000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_sentry }
		NOT = { has_global_flag = vanilla_array_disabled }
		OR = {
			check_variable = { which = giga_vanilla_array_cap value = 0 }						# No Cap
			check_variable = { which = giga_current_vanilla_array value < giga_vanilla_array_cap }
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_vanilla_array_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_vanilla_array value < giga_vanilla_array_cap }
				}
			}
		}
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_sentry_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_sentry
			
			set_star_flag = spy_orb_built
			from = {
				set_timed_country_flag = { flag = has_recently_built_spy_orb years = 20 }
				set_country_flag = built_spyorb
				change_variable = { which = giga_current_vanilla_array value = 1 }
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_spy_orb_0
						planet = this.star
						orbit_distance = 65 
						orbit_angle = 210
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

# ang 270 dis 30
xhk_extraframe_add_art_install = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_art_install

	prerequisites = {
		tech_mega_art
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 3000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_mega_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_art_install }
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_vanilla_art_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_vanilla_art value < giga_vanilla_art_cap }
				}
			}
		}
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_art_install_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_art_install

			from = {
				set_timed_country_flag = { flag = has_recently_built_mega_art_installation years = 20 }
				set_country_flag = built_mega_art_installation_site
				change_variable = { which = giga_current_vanilla_art value = 1 }
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_megaart_0
						orbit_distance = 30 
						orbit_angle = 270
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

xhk_extraframe_upgrade_art_install = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_art_install

	prerequisites = {
		tech_mega_art
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 500
	
	resources = {
		category = megastructures
		cost = {
			energy = 2000
			minor_artifacts = 2000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		has_deposit = xhk_extraframe_megaart
	}
	
	allow = {		
		has_major_upgraded_capital = yes
	}
	
	effect = {
		custom_tooltip = xhk_extraframe_upgrade_art_install_effect

		remove_deposit = xhk_extraframe_megaart
		add_deposit = xhk_extraframe_megaart_2

		hidden_effect = {
			from = { country_event = { id = ancrel.10030 }}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

xhk_extraframe_add_interstellar_assem = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_interstellar_assem

	prerequisites = {
		tech_interstellar_assembly
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 3000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_interstellar_assem }
		NOT = { has_global_flag = vanilla_interstellar_disabled }
		OR = {
			check_variable = { which = giga_vanilla_interstellar_cap value = 0 }						# No Cap
			check_variable = { which = giga_current_vanilla_interstellar value < giga_vanilla_interstellar_cap }
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_vanilla_interstellar_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_vanilla_interstellar value < giga_vanilla_interstellar_cap }
				}
			}
		}
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_interstellar_assem_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_interstellar_assem

			from = {
				set_timed_country_flag = { flag = has_recently_built_interstellar_assembly years = 20 }
				set_country_flag = built_interstellar_assembly_site
				change_variable = { which = giga_current_vanilla_interstellar value = 1 }
			}
			
			from = {
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_interassemb_0
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

### MAJOR UPGRADES
###########################################################################################################
xhk_extraframe_add_orbring = {
	icon = decision_xhk_extraframe_add_orbring
	owned_planets_only = yes
	
	prerequisites = {
		tech_orbital_ring_tier_1
	}
	
	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}
	
	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 1000
			influence = 100
		}
	}
	
	potential = {
		has_overlord_dlc = yes
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		giga_is_frame_world = yes
		not = {
			has_planet_flag = xhk_extraframe_orbring
		}
	}
	
	allow = {
		owner = { has_technology = tech_starbase_5 }
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = giga_frameworld_upgrade_warning
		custom_tooltip = xhk_extraframe_add_orbring_effect

		hidden_effect = {
			set_planet_flag = frameworld_upgrade
			set_planet_flag = xhk_extraframe_orbring
			
			solar_system = {
				spawn_megastructure = {
					type = xhk_extraframe_orbring_0
					planet = this
					owner = from
				}
			}

			if = {
				limit = { exists = owner }
				owner = {
					country_event = {
						id = xhk_extraframe_notif.060
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}
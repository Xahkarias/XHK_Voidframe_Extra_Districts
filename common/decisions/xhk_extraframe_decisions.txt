### ENCLAVES
###########################################################################################################

# 100 deg, 50 dist
xhk_extraframe_add_enclave_curator = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_curator }
		exists = event_target:curator_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:curator_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:curator_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_curator_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_curator

			star = {
				event_target:curator_enclave_country = {
					create_fleet = {
						name = "NAME_Curator_Alpha_Enclave"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Curator_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 100
								distance = 50
							}
						}
					}
				}
				this.solar_system = {
					save_global_event_target_as = curator_enclave_system
					set_star_flag = enclave
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 80 deg, 50 dist
xhk_extraframe_add_enclave_artisan = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_artisan }
		exists = event_target:artist_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:artist_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:artist_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_artisan_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_artisan

			star = {
				event_target:artist_enclave_country = {
					create_fleet = {
						name = "NAME_Ars_Artem"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Artist_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 80
								distance = 50
							}
							set_fleet_flag = artist_enclave_station
						}
					}
				}
				this.solar_system = {
					save_global_event_target_as = artisan_enclave_system
					set_star_flag = enclave
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 280 deg, 50 dist
xhk_extraframe_add_enclave_xuracorp = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_xuracorp }
		exists = event_target:xuracorp_country
		is_planet_class = pc_giga_frameworld
		event_target:xuracorp_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:xuracorp_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_xuracorp_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_xuracorp

			star = {
				event_target:xuracorp_country = {
					create_fleet = {
						name = "NAME_XuraCorp_HQ"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Trader_Enclave_Station"
								graphical_culture = prev
							}
							set_location = {
								target = prevprev
								angle = 280
								distance = 50
							}
							set_fleet_flag = trader_enclave_station
						}
					}
				}
				this.solar_system = {
					set_star_flag = xuracorp_enclave_system
					set_star_flag = enclave
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 275 deg, 50 dist
xhk_extraframe_add_enclave_riggian = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_riggian }
		exists = event_target:riggan_country
		is_planet_class = pc_giga_frameworld
		event_target:riggan_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:riggan_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_riggian_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_riggian

			star = {
				event_target:riggan_country = {
					create_fleet = {
						name = "NAME_Grand_Bazaar"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Trader_Enclave_Station"
								graphical_culture = prev
							}
							set_location = {
								target = prevprev
								angle = 275
								distance = 50
							}
							set_fleet_flag = trader_enclave_station
						}
					}
				}
				this.solar_system = {
					set_star_flag = enclave
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 290 deg, 50 dist
xhk_extraframe_add_enclave_muutagan = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_muutagan }
		exists = event_target:muutagan_country
		is_planet_class = pc_giga_frameworld
		event_target:muutagan_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:muutagan_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_muutagan_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_muutagan

			star = {
				event_target:muutagan_country = {
					create_fleet = {
						name = "NAME_Muutag_Station"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Trader_Enclave_Station"
								graphical_culture = prev
							}
							set_location = {
								target = prevprev
								angle = 290
								distance = 50
							}
							set_fleet_flag = trader_enclave_station
						}
					}
				}
				this.solar_system = {
					set_star_flag = enclave
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 285 deg, 50 dist
xhk_extraframe_add_enclave_museum = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_museum }
		exists = event_target:MYH_museum_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:MYH_museum_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:MYH_museum_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_museum_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_museum

			star = {
				event_target:MYH_museum_enclave_country = {
					create_fleet = {
						name = "NAME_Archivist_Ship"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Archivist_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 285
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 285 deg, 50 dist
# almost duplicate of above, they should never spawn together
xhk_extraframe_add_enclave_museum_forgotten_hist = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_museum }
		exists = event_target:AAA_museum_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:AAA_museum_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:AAA_museum_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_museum_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_museum

			star = {
				event_target:AAA_museum_enclave_country = {
					create_fleet = {
						name = "NAME_Archivista_Enclave_Station"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Archivista_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 285
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 295 deg, 50 dist
xhk_extraframe_add_enclave_garden = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_garden }
		exists = event_target:MYH_garden_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:MYH_garden_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:MYH_garden_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_garden_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_garden

			star = {
				event_target:MYH_garden_enclave_country = {
					create_fleet = {
						name = "NAME_Gardener_Ship"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Gardener_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 295
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 300 deg, 50 dist
xhk_extraframe_add_enclave_lawyer = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_lawyer }
		exists = event_target:MYH_lawyer_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:MYH_lawyer_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:MYH_lawyer_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_lawyer_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_lawyer

			star = {
				event_target:MYH_lawyer_enclave_country = {
					create_fleet = {
						name = "NAME_Lawyer_Ship"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Lawyer_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 300
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 305 deg, 50 dist
xhk_extraframe_add_enclave_exo = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_exo }
		exists = event_target:MYH_exo_enclave_country
		is_planet_class = pc_giga_frameworld
		event_target:MYH_exo_enclave_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:MYH_exo_enclave_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_exo_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_exo

			star = {
				event_target:MYH_exo_enclave_country = {
					create_fleet = {
						name = "NAME_Exo_Ship_1"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Exo_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 305
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 310 deg, 50 dist
xhk_extraframe_add_enclave_hive = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_hive }
		exists = event_target:ne_hive_country
		is_planet_class = pc_giga_frameworld
		event_target:ne_hive_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:ne_hive_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_hive_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_hive

			star = {
				event_target:ne_hive_country = {
					create_fleet = {
						name = "NAME_NEHIV_Fleet"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_NEHIV_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 310
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 315 deg, 50 dist
xhk_extraframe_add_enclave_drg = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_drg }
		exists = event_target:ne_drg_country
		is_planet_class = pc_giga_frameworld
		event_target:ne_drg_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:ne_drg_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_drg_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_drg

			star = {
				event_target:ne_drg_country = {
					create_fleet = {
						name = "NAME_NEDRG_Fleet_3"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_NEDRG_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 315
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

# 320 deg, 50 dist
xhk_extraframe_add_enclave_mach = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_enclave

	enactment_time = 200

	resources = {
		category = megastructures
		cost = {
			alloys = 500
			influence = 100
			unity = 1000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		NOT = { has_planet_flag = xhk_extraframe_enclave_mach }
		exists = event_target:ne_machine_country
		is_planet_class = pc_giga_frameworld
		event_target:ne_machine_country = {
			trust = {
				who = from
				value >= 50
			}
		}
	}

	allow = {
		event_target:ne_machine_country = {
			trust = {
				who = from
				value >= 90
			}
		}
		planet_size >= 75
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_enclave_mach_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_enclave_mach

			star = {
				event_target:ne_machine_country = {
					create_fleet = {
						name = "NAME_NEMAC_Fleet"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_NEMAC_Enclave_Station"
								graphical_culture = prev
							}							
							set_location = {
								target = prevprev
								angle = 320
								distance = 50
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

### MAJOR UPGRADES
############################################################################################################
xhk_extraframe_add_hyperstructural = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_hyperstructural

	prerequisites = {
		giga_tech_hyperstructural_ass
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 3600
	
	resources = {
		category = megastructures
		cost = {
			alloys = 10000
			influence = 300
		}
	}
	
	potential = {
		NOT = { has_global_flag = hyperstructural_ass_disabled }
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
			has_gigastructural_constructs = yes
		}
		giga_is_frame_world = yes
		NOT = { has_planet_flag = xhk_extraframe_hyperstructural }
		OR = {
			check_variable = { which = giga_hyperstructural_ass_cap value = 0 }						# No Cap
			check_variable = { which = giga_current_hyperstructural_ass value < giga_hyperstructural_ass_cap }
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		has_deposit = d_frameworld_decompressor
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_hyperstructural_ass_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_hyperstructural_ass value < giga_hyperstructural_ass_cap }
				}
			}
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = giga_frameworld_upgrade_warning
		custom_tooltip = xhk_extraframe_add_hyperstructural_effect

		hidden_effect = {
			set_planet_flag = frameworld_upgrade
			set_planet_flag = xhk_extraframe_hyperstructural

			from = {
				change_variable = { which = giga_current_hyperstructural_ass value = 1 }
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_hyperass_0
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}

				save_event_target_as = giga_system
				if = { limit = { exists = fromfrom.planet } fromfrom.planet = { save_event_target_as = giga_planet } }
				from = { country_event = { id = giga_dialog.3702 } }	# Notification
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}


### AMBIENT STRUCTURES
###########################################################################################################

# ang 270 dis 50
xhk_extraframe_add_think_tank = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_think_tank

	prerequisites = {
		tech_science_nexus
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_think_tank }
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_vanilla_nexus_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_vanilla_nexus value < giga_vanilla_nexus_cap }
				}
			}
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_think_tank_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_think_tank

			from = {
				set_timed_country_flag = { flag = has_recently_built_think_tank years = 20 }
				set_country_flag = built_think_tank
				change_variable = { which = giga_current_vanilla_nexus value = 1 }
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_think_tank_0
						planet = this.star
						orbit_distance = 50 
						orbit_angle = 270
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

# ang 110 dis 30
xhk_extraframe_add_strat_coord = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_strat_coord

	prerequisites = {
		tech_strategic_coordination
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_mega_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_strat_coord }
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_vanilla_strategic_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_vanilla_strategic value < giga_vanilla_strategic_cap }
				}
			}
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_strat_coord_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_strat_coord

			from = {
				set_timed_country_flag = { flag = has_recently_built_strategic_coordination_center years = 20 }
				set_country_flag = built_strategic_coordination_center_site
				change_variable = { which = giga_current_vanilla_strategic value = 1 }
			}	

			from = {
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_stratcoord_0
						orbit_distance = 5 
						orbit_angle = 145
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

# ang 210 dis 65
xhk_extraframe_add_sentry= {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_sentry

	prerequisites = {
		tech_sentry_array
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 3000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_sentry }
		NOT = { has_global_flag = vanilla_array_disabled }
		OR = {
			check_variable = { which = giga_vanilla_array_cap value = 0 }						# No Cap
			check_variable = { which = giga_current_vanilla_array value < giga_vanilla_array_cap }
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_vanilla_array_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_vanilla_array value < giga_vanilla_array_cap }
				}
			}
		}
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_sentry_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_sentry
			
			set_star_flag = spy_orb_built
			from = {
				set_timed_country_flag = { flag = has_recently_built_spy_orb years = 20 }
				set_country_flag = built_spyorb
				change_variable = { which = giga_current_vanilla_array value = 1 }
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_spy_orb_0
						planet = this.star
						orbit_distance = 65 
						orbit_angle = 210
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

# ang 270 dis 30
xhk_extraframe_add_art_install = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_art_install

	prerequisites = {
		tech_mega_art
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 3000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_mega_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_art_install }
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_vanilla_art_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_vanilla_art value < giga_vanilla_art_cap }
				}
			}
		}
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_art_install_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_art_install

			from = {
				set_timed_country_flag = { flag = has_recently_built_mega_art_installation years = 20 }
				set_country_flag = built_mega_art_installation_site
				change_variable = { which = giga_current_vanilla_art value = 1 }
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_megaart_0
						orbit_distance = 30 
						orbit_angle = 270
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

xhk_extraframe_upgrade_art_install = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_art_install

	prerequisites = {
		tech_mega_art
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 500
	
	resources = {
		category = megastructures
		cost = {
			energy = 2000
			minor_artifacts = 2000
		}
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		has_deposit = xhk_extraframe_megaart
	}
	
	allow = {		
		has_major_upgraded_capital = yes
	}
	
	effect = {
		custom_tooltip = xhk_extraframe_upgrade_art_install_effect

		remove_deposit = xhk_extraframe_megaart
		add_deposit = xhk_extraframe_megaart_2

		hidden_effect = {
			from = { country_event = { id = ancrel.10030 }}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

xhk_extraframe_add_interstellar_assem = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_interstellar_assem

	prerequisites = {
		tech_interstellar_assembly
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 3000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_interstellar_assem }
		NOT = { has_global_flag = vanilla_interstellar_disabled }
		OR = {
			check_variable = { which = giga_vanilla_interstellar_cap value = 0 }						# No Cap
			check_variable = { which = giga_current_vanilla_interstellar value < giga_vanilla_interstellar_cap }
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_vanilla_interstellar_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_vanilla_interstellar value < giga_vanilla_interstellar_cap }
				}
			}
		}
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_interstellar_assem_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_interstellar_assem

			from = {
				set_timed_country_flag = { flag = has_recently_built_interstellar_assembly years = 20 }
				set_country_flag = built_interstellar_assembly_site
				change_variable = { which = giga_current_vanilla_interstellar value = 1 }
			}
			
			from = {
				solar_system = {
					spawn_megastructure = {
						type = xhk_extraframe_interassemb_0
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

# kugel
xhk_extraframe_add_kugel_norm = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_kugel_norm

	prerequisites = {
		giga_tech_kugelblitz
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOR = { 
			has_deposit = xhk_extraframe_storage_kugel_norm
			has_deposit = xhk_extraframe_storage_kugel_mega
			has_deposit = xhk_extraframe_storage_kugel_tera
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_kugel_norm_effect

		hidden_effect = {
			add_deposit = xhk_extraframe_storage_kugel_norm
			owner = { recalculate_frameworld_storage = yes }

			create_ambient_object = {
				type = giga_extraframe_kugelblitz_xhk
				location = from
				use_3d_location = yes
				entity_face_object = no
				entity_offset_angle = 215
				entity_offset_height = 14
				entity_offset = 40
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

xhk_extraframe_add_kugel_mega = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_kugel_norm

	prerequisites = {
		tech_mega_engineering
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		has_deposit = xhk_extraframe_storage_kugel_norm
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_kugel_norm_effect

		hidden_effect = {
			remove_deposit = xhk_extraframe_storage_kugel_norm
			add_deposit = xhk_extraframe_storage_kugel_mega
			owner = { recalculate_frameworld_storage = yes }
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

xhk_extraframe_add_kugel_tera = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_kugel_norm

	prerequisites = {
		giga_tech_tetradimensional_engineering
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		has_deposit = xhk_extraframe_storage_kugel_mega
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_kugel_norm_effect

		hidden_effect = {
			remove_deposit = xhk_extraframe_storage_kugel_mega
			add_deposit = xhk_extraframe_storage_kugel_tera
			owner = { recalculate_frameworld_storage = yes }
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

### STRUCTURES
###########################################################################################################

xhk_extraframe_add_catapult = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_catapult

	prerequisites = {
		tech_quantum_catapult
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 3000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 300
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_catapult }
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip = {
			fail_text = "requires_no_existing_quantum_catapult"
			from = { NOT = { has_country_flag = built_quantum_catapult_site } }
		}
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_catapult_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_catapult

			from = {
				set_country_flag = built_quantum_catapult_site
				country_event = { id = tutorial.2126 }
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = quantum_catapult_0
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

# ang 145 dis 50
xhk_extraframe_add_big_vat = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_add_big_vat

	prerequisites = {
		giga_tech_the_vat
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 3000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_extraframe_big_vat }
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip = {
			fail_text = "requires_not_capped"
			from = {
				OR = {
					check_variable = { which = giga_the_vat_cap value = 0 }						# No Cap
					check_variable = { which = giga_current_the_vat value < giga_the_vat_cap }
				}
			}
		}
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_extraframe_add_big_vat_effect

		hidden_effect = {
			set_planet_flag = xhk_extraframe_big_vat

			from = {
				set_timed_country_flag = { flag = has_recently_built_the_vat years = 20 }
				country_event = { id = giga_dialog.11301 }	# Notification
				change_variable = { which = giga_current_the_vat value = 1 }
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = the_vat_0
						orbit_distance = 50 
						orbit_angle = 145
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

### PD STUFF
###########################################################################################################

### schlorp THE EXOTIC RESOURCE
xhk_extraframe_schlorp_eludium = {
	owned_planets_only = yes
	icon = decision_harvest_matter_for_planetary_printing
	enactment_time = 100
	ai_weight = { weight = 0 }

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_deposit = xhk_extraframe_eludium }
		has_global_flag = planetarydiversityuniques
	}	

	allow = {
		custom_tooltip = {
			fail_text = "xhk_extraframe_eludium_continent_failtext"
			from = {
				any_planet_within_border = {
					has_planet_flag = pd_floating_planet
					has_planet_flag = giga_frameworld_outpost
				}
			}
		}
	}

	resources = {
		category = resources
		cost = {
			alloys = 5000
			energy = 15000
		}
	}

	show_tech_unlock_if = {
		giga_has_frameworld_origin = yes
		has_global_flag = planetarydiversityuniques
	}

	prerequisites = { giga_tech_terraform_shattered }

	effect = {
		add_deposit = xhk_extraframe_eludium
		planet_owner = {
			## give the first tech
			if = {
				limit = {
					nor = { 
						has_technology = tech_eludium_research
						has_tech_option = tech_eludium_research
					}
				}
				add_research_option = tech_eludium_research
			}	
		}	
	}
}

xhk_extraframe_schlorp_crystal = {
	owned_planets_only = yes
	icon = decision_harvest_matter_for_planetary_printing
	enactment_time = 100
	ai_weight = { weight = 0 }

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOR = { 
			has_deposit = xhk_extraframe_crystal 
			has_deposit = xhk_extraframe_crystal_activated
		}
		has_global_flag = planetarydiversityuniques
	}	

	allow = {
		custom_tooltip = {
			fail_text = "xhk_extraframe_crystal_continent_failtext"
			from = {
				any_planet_within_border = {
					has_planet_flag = pd_crystal_planet
					has_planet_flag = giga_frameworld_outpost
				}
			}
		}
	}

	resources = {
		category = resources
		cost = {
			alloys = 5000
			energy = 15000
		}
	}

	show_tech_unlock_if = {
		giga_has_frameworld_origin = yes
		has_global_flag = planetarydiversityuniques
	}

	prerequisites = { giga_tech_yggdrasil_orchid }

	effect = {
		add_deposit = xhk_extraframe_crystal
		planet_owner = {
			## give the first tech
			if = {
				limit = {
					nor = { 
						has_technology = tech_acean_research
						has_tech_option = tech_acean_research
					}
				}
				add_research_option = tech_acean_research
			}	
		}	
	}
}

### copy of PD unique
xhk_extraframe_pd_add_floating_island = {
	icon = decision_pd_add_floating_island
	owned_planets_only = yes

	enactment_time = 720
	resources = {
		category = decisions
		cost = {
			sr_eludium = 2500
			influence = 50
		}
	}

	allow = {
		owner = {
			has_technology = tech_eludium_floating_islands
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_deposit = d_pd_artifical_floating_islands }
		# allowed frameworld to access the decision
	}

	potential = {
		owner = {
			has_technology = tech_eludium_floating_islands
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_deposit = d_pd_artifical_floating_islands }
		has_global_flag = planetarydiversityuniques
	}

	effect = {
		add_deposit = d_pd_artifical_floating_islands
		# removed the floating islands visual effect
	}

	ai_weight = {
        weight = 10
  	}
}

xhk_extraframe_pd_add_acean_superorganism_larva = {
	icon = decision_pd_add_acean_superorganism_larva
	owned_planets_only = yes

	enactment_time = 720
	resources = {
		category = decisions
		cost = {
			sr_acean = 2500
			influence = 50
		}
	}

	allow = {
		owner = {
			has_technology = tech_acean_superorganism_larva
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_deposit = xhk_extraframe_crystal_activated }
		has_deposit = xhk_extraframe_crystal
		# allowed frameworld to access the decision	
	}

	potential = {
		owner = {
			has_technology = tech_acean_superorganism_larva
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_deposit = xhk_extraframe_crystal_activated }
		has_global_flag = planetarydiversityuniques
	}

	effect = {
		add_deposit = xhk_extraframe_crystal_activated
		remove_deposit = xhk_extraframe_crystal
	}

	ai_weight = {
        weight = 10
  	}
}

### DEPOSITS
###########################################################################################################

xhk_extraframe_add_vivarium_deposit = {
	owned_planets_only = yes
	icon = decision_xhk_extraframe_vivarium

	enactment_time = 200
	
	resources = {
		category = megastructures
		cost = {
			alloys = 1000
			energy = 200
		}
	}
	
	prerequisites = {
		tech_gravity_wells
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_deposit = xhk_extraframe_vivarium }
		owner = { has_technology = "tech_gravity_wells" }
	}

	allow = {
		free_district_slots > 0
	}

	effect = {
		custom_tooltip = xhk_extraframe_add_vivarium_deposit_effect
		hidden_effect = {
			add_deposit = xhk_extraframe_vivarium
		}
	}
	
	ai_weight = {
		weight = 10
	}
}
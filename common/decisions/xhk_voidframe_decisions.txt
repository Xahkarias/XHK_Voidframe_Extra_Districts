
### DEPOSITS
###########################################################################################################

xhk_voidframe_add_vivarium_deposit = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_vivarium

	enactment_time = 200
	
	resources = {
		category = megastructures
		cost = {
			alloys = 1000
			energy = 200
		}
	}
	
	prerequisites = {
		tech_gravity_wells
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_deposit = xhk_voidframe_vivarium }
		owner = { has_technology = "tech_gravity_wells" }
	}

	allow = {
		free_district_slots > 0
	}

	effect = {
		custom_tooltip = xhk_voidframe_add_vivarium_deposit_effect
		hidden_effect = {
			add_deposit = xhk_voidframe_vivarium
		}
	}
	
	ai_weight = {
		weight = 10
	}
}



### MAJOR UPGRADES
###########################################################################################################
xhk_voidframe_add_mbrain = {
	icon = decision_xhk_voidframe_add_mbrain
	owned_planets_only = yes
	
	prerequisites = {
		giga_tech_matrioshka_brain_1
	}
	
	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}
	
	enactment_time = 3600
	
	resources = {
		category = megastructures
		cost = {
			alloys = 10000
			influence = 300
		}
	}
	
	potential = {
		NOT = { has_global_flag = matrioshka_brain_disabled }
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		giga_is_frame_world = yes
		not = {
			has_planet_flag = xhk_voidframe_mbrain
		}
	}
	
	allow = {
		has_deposit = d_frameworld_penrose
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = giga_frameworld_upgrade_warning
		custom_tooltip = xhk_voidframe_add_mbrain_effect

		hidden_effect = {
			set_planet_flag = frameworld_upgrade
			set_planet_flag = xhk_voidframe_mbrain
			
			solar_system = {
				spawn_megastructure = {
					type = xhk_frameworld_mbrain_0
					owner = owner
					planet = star
				}
				save_event_target_as = giga_system
			}

			if = {
				limit = { exists = owner }
				owner = {
					country_event = {
						id = xhk_voidframe_notif.002
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}



## AMBIENT

xhk_voidframe_add_kugel_norm = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_kugel_norm

	prerequisites = {
		giga_tech_kugelblitz
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOR = { 
			has_deposit = xhk_voidframe_storage_kugel_norm
			has_deposit = xhk_voidframe_storage_kugel_mega
			has_deposit = xhk_voidframe_storage_kugel_tera
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_kugel_norm_effect

		hidden_effect = {
			add_deposit = xhk_voidframe_storage_kugel_norm
			owner = { recalculate_frameworld_storage = yes }

			create_ambient_object = {
				type = giga_voidframe_kugelblitz_xhk
				location = from
				use_3d_location = yes
				entity_face_object = no
				entity_offset_angle = 215
				entity_offset_height = 14
				entity_offset = 40
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

xhk_voidframe_add_kugel_mega = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_kugel_norm

	prerequisites = {
		tech_mega_engineering
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		has_deposit = xhk_voidframe_storage_kugel_norm
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_kugel_norm_effect

		hidden_effect = {
			remove_deposit = xhk_voidframe_storage_kugel_norm
			add_deposit = xhk_voidframe_storage_kugel_mega
			owner = { recalculate_frameworld_storage = yes }
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

xhk_voidframe_add_kugel_tera = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_kugel_norm

	prerequisites = {
		giga_tech_tetradimensional_engineering
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			unity = @giga_big_mega_start_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		has_deposit = xhk_voidframe_storage_kugel_mega
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_kugel_norm_effect

		hidden_effect = {
			remove_deposit = xhk_voidframe_storage_kugel_mega
			add_deposit = xhk_voidframe_storage_kugel_tera
			owner = { recalculate_frameworld_storage = yes }
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

## STRUCTURES

#moon print 
#angle 75 (90-15)
xhk_voidframe_add_moonprint_one = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_moonprint

	prerequisites = {
		giga_tech_lunar_assembly
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 100
			unity = @giga_giga_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_global_flag = warmoon_disabled }
		NOT = { has_planet_flag = xhk_voidframe_moonprint_one }
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_moonprint_one_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_moonprint_one

			from = {
				country_event = { id = giga_printer.1010 }	# Notification
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = lunar_macroreplicator_0_real
						orbit_distance = 70 
						orbit_angle = 75
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#angle 255 (270-15)
xhk_voidframe_add_moonprint_two = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_moonprint

	prerequisites = {
		giga_tech_lunar_assembly
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 100
			unity = @giga_giga_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_global_flag = warmoon_disabled }
		NOT = { has_planet_flag = xhk_voidframe_moonprint_two }
		has_planet_flag = xhk_voidframe_moonprint_one
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_moonprint_two_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_moonprint_two

			from = {
				country_event = { id = giga_printer.1010 }	# Notification
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = lunar_macroreplicator_0_real
						orbit_distance = 70 
						orbit_angle = 255
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#angle 105 (90+15)
xhk_voidframe_add_moonprint_three = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_moonprint

	prerequisites = {
		giga_tech_lunar_assembly
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 100
			unity = @giga_giga_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_global_flag = warmoon_disabled }
		NOT = { has_planet_flag = xhk_voidframe_moonprint_three }
		has_planet_flag = xhk_voidframe_moonprint_two
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_moonprint_three_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_moonprint_three

			from = {
				country_event = { id = giga_printer.1010 }	# Notification
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = lunar_macroreplicator_0_real
						orbit_distance = 70 
						orbit_angle = 105
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}				
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#angle 285 (270+15)
xhk_voidframe_add_moonprint_four = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_moonprint

	prerequisites = {
		giga_tech_lunar_assembly
	}

	show_tech_unlock_if = {
		always = no
	}

	enactment_time = 1000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 100
			unity = @giga_giga_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_global_flag = warmoon_disabled }
		NOT = { has_planet_flag = xhk_voidframe_moonprint_four }
		has_planet_flag = xhk_voidframe_moonprint_three
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_moonprint_four_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_moonprint_four

			from = {
				country_event = { id = giga_printer.1010 }	# Notification
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = lunar_macroreplicator_0_real
						orbit_distance = 70 
						orbit_angle = 285
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}				
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#angle 270+-30, 90+-30
xhk_voidframe_add_moonprint_four_more = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_moonprint

	prerequisites = {
		giga_tech_lunar_assembly
	}

	show_tech_unlock_if = {
		always = no
	}

	enactment_time = 4000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 25000
			influence = 300
			unity = @giga_giga_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_global_flag = warmoon_disabled }
		NOT = { has_planet_flag = xhk_voidframe_moonprint_four_more }
		has_planet_flag = xhk_voidframe_moonprint_four
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_moonprint_four_more_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_moonprint_four_more

			from = {
				solar_system = {
					spawn_megastructure = {
						type = lunar_macroreplicator_0_real
						orbit_distance = 70 
						orbit_angle = 300
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
					spawn_megastructure = {
						type = lunar_macroreplicator_0_real
						orbit_distance = 70 
						orbit_angle = 240
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
					spawn_megastructure = {
						type = lunar_macroreplicator_0_real
						orbit_distance = 70 
						orbit_angle = 120
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
					spawn_megastructure = {
						type = lunar_macroreplicator_0_real
						orbit_distance = 70 
						orbit_angle = 60
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}				
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#planet print 
#angle 90
xhk_voidframe_add_planetprint = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_planetprint

	prerequisites = {
		giga_tech_planet_assembly
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 2000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 100
			unity = @giga_giga_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_global_flag = warplanet_disabled }
		NOT = { has_planet_flag = xhk_voidframe_planetprint }
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_planetprint_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_planetprint

			from = {
				country_event = { id = giga_printer.2010 }	# Notification
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = planetcraft_printer_0_real
						orbit_distance = 80 
						orbit_angle = 90
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#angle 270
xhk_voidframe_add_planetprint_two = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_planetprint

	prerequisites = {
		giga_tech_planet_assembly
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 2000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 100
			unity = @giga_giga_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_global_flag = warplanet_disabled }
		NOT = { has_planet_flag = xhk_voidframe_planetprint_two }
		has_planet_flag = xhk_voidframe_planetprint
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_planetprint_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_planetprint_two

			from = {
				country_event = { id = giga_printer.2010 }	# Notification
			}

			from = {
				solar_system = {
					spawn_megastructure = {
						type = planetcraft_printer_0_real
						orbit_distance = 80 
						orbit_angle = 270
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#systemprinter
xhk_voidframe_add_systemprint = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_add_systemprint

	prerequisites = {
		tech_stellar_assembler
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 5000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 700000
			unity = @giga_tera_unity_cost
			rare_crystals = 8000
			volatile_motes = 8000
			exotic_gases = 8000
			#very expensive because we skip to level 3 to avoid the planet destroying effect on T2
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_voidframe_systemprint }
		stellar_manip_is_active = yes
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_systemprint_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_systemprint

			from = {
				solar_system = {
					spawn_megastructure = {
						type = systemcraft_assembler_3
						orbit_distance = 0 
						orbit_angle = 0
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#aetheromirror
xhk_voidframe_add_dsst0 = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_add_dsst0

	prerequisites = {
		tech_sm_summon_gateway
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 2000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 750000
			sr_dark_matter = 50000
			acot_sr_dark_energy = 50000
			influence = 500
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_voidframe_dsst }
		custom_tooltip = {
			fail_text = "requires_no_existing_dsst"
			from = { NOT = { has_country_flag = built_dsst } }
		}
		has_sots = yes
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_ddst_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_dsst
			from = {
				solar_system = {
					save_event_target_as = dsst_system	#system
					set_star_flag = sm_dsst_explosion_source #system
					spawn_megastructure = {
						type = deep_shroud_summoning_threshold_0_xhk_dupl
						orbit_distance = 0 
						orbit_angle = 0
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
				set_country_flag = built_dsst	#country
			}
			save_event_target_as = sm_dsst #should be megastructure, but targets planet
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

#lathe
#45 deg, 60 dis
xhk_voidframe_add_cosmolathe = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_add_cosmolathe

	prerequisites = {
		tech_cosmogenesis_world
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 2000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 15000
			influence = 300
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_voidframe_cosmolathe }
		custom_tooltip = {
			fail_text = "requires_no_existing_cosmogenesis_world"
			from = {
				NOT = { has_country_flag = cosmogenesis_world_built }
			}
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}

	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_cosmolathe_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_cosmolathe
			from = { set_country_flag = cosmogenesis_world_built }
			from = {
				solar_system = {
					spawn_planet = {
						class = "pc_cosmogenesis_world"
						location = this.star
						orbit_location = yes
						orbit_angle_offset = 45
						orbit_distance_offset = 60
						plane_offset = 5
						size = 2
						has_ring = no
					
						init_effect = {
							set_name = {
								key = pc_cosmogenesis_world
							}
							set_planet_entity = {
								entity = "neural_calculator_phase_1_entity"
							}
							set_surveyed = {
								surveyed = yes
								surveyor = FROM
							}
							set_all_comms_surveyed = yes
							clear_blockers = yes
					
							set_planet_flag = megastructure
							set_planet_flag = cosmogenesis_world_resettle@from
					
							fromfrom.planet = {
								set_planet_flag = has_megastructure
								set_planet_flag = has_cosmogenesis_world
								if = {
									limit = { has_orbital_station = yes }
									orbital_station = {
										dismantle = yes
									}
								}
							}
					
							set_owner = fromfrom
							set_controller = fromfrom
							create_pop = {
								species = owner_main_species
							}
							from = {
								room_name_override = ""
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#psibeacon
#150 deg, 60 dis
xhk_voidframe_add_psibeacon = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_add_psibeacon

	prerequisites = {
		giga_tech_psychic_beacon
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 2000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 100
			unity = @giga_giga_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_global_flag = psychic_beacon_disabled }
		NOT = { has_planet_flag = xhk_voidframe_psibeacon }
		OR = {
			check_variable = { which = giga_psychic_beacon_cap value = 0 }						# No Cap
			check_variable = { which = giga_current_psychic_beacon value < giga_psychic_beacon_cap }
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_psibeacon_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_psibeacon

			from = {
				change_variable = { which = giga_current_psychic_beacon value = 1 }
				solar_system = {
					spawn_megastructure = {
						type = psychic_beacon_1
						orbit_distance = 60 
						orbit_angle = 150
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#135 deg, 60 dis
#beyond the shroud labyrinth
# xhk_voidframe_add_labyrinthabs = {
# 	owned_planets_only = yes
# 	icon = decision_xhk_voidframe_add_labyrinthabs

# 	enactment_time = 2000
	
# 	resources = {
# 		category = megastructures
# 		cost = {
# 			alloys = 5000
# 			influence = 50
# 		}
# 	}
	
# 	potential = {
# 		exists = owner
# 		owner = {
# 			giga_has_frameworld_origin = yes
# 			has_country_flag = bts_labyrinth_of_abstraction_unlocked
# 		}
# 		is_planet_class = pc_giga_frameworld
# 		NOT = { has_planet_flag = xhk_voidframe_labyrinthabs }
#         NOT = {
#             any_planet_within_border = {
#                 is_planet_class = pc_bts_labyrinth_of_abstraction
#             }
#         }
# 	}
	
# 	allow = {		
# 		has_major_upgraded_capital = yes
# 	}

# 	effect = {
# 		custom_tooltip = xhk_voidframe_add_labyrinthabs_effect

# 		hidden_effect = {
# 			set_planet_flag = xhk_voidframe_labyrinthabs
# 			from = {
# 				solar_system = {
# 					spawn_planet = {
# 						class = "pc_bts_labyrinth_of_abstraction"
# 						location = this.star
# 						orbit_location = yes
# 						orbit_angle_offset = 135
# 						orbit_distance_offset = 60
# 						plane_offset = 5
# 						has_ring = no
					
# 						init_effect = {
# 							set_name = {
# 								key = pc_bts_labyrinth_of_abstraction
# 							}
# 							set_surveyed = {
# 								surveyed = yes
# 								surveyor = FROM
# 							}
# 							set_all_comms_surveyed = yes
# 							clear_blockers = yes
# 							clear_deposits = yes
# 							prevent_anomaly = yes
				
# 							set_planet_flag = megastructure
				
# 							set_owner = fromfrom
# 							set_controller = fromfrom
# 							create_pop = {
# 								species = owner_main_species
# 							}
# 							from = {
# 								room_name_override = ""
# 							}
				
# 							remove_all_buildings = yes
# 							add_building = bts_labyrinth_of_abstraction_core_1
							
# 							owner = {
# 								if = {
# 									limit = {
# 										NOT = {
# 											any_situation = { is_situation_type = situation_bts_conceptual_mastery }
# 										}
# 									}
# 									country_event = {
# 										id = bts.20
# 										days = @bts_days_before_conceptual_mastery
# 										scopes = {
# 											from = prev
# 										}
# 									}
# 								}
# 							}
# 						}
# 					}
# 				}
# 			}
# 		}
# 	}
	
# 	ai_weight = {
# 		weight = 0
# 	}
# }



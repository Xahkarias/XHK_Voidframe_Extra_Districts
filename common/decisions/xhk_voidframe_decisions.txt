




### MAJOR UPGRADES
###########################################################################################################
xhk_voidframe_add_mbrain = {
	icon = decision_xhk_voidframe_add_mbrain
	owned_planets_only = yes
	
	prerequisites = {
		giga_tech_matrioshka_brain_1
	}
	
	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}
	
	enactment_time = 3600
	
	resources = {
		category = megastructures
		cost = {
			alloys = 10000
			influence = 300
		}
	}
	
	potential = {
		NOT = { has_global_flag = matrioshka_brain_disabled }
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		giga_is_frame_world = yes
		not = {
			has_planet_flag = xhk_voidframe_mbrain
		}
	}
	
	allow = {
		has_deposit = d_frameworld_penrose
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = giga_frameworld_upgrade_warning
		custom_tooltip = xhk_voidframe_add_mbrain_effect

		hidden_effect = {
			set_planet_flag = frameworld_upgrade
			set_planet_flag = xhk_voidframe_mbrain
			
			solar_system = {
				spawn_megastructure = {
					type = xhk_frameworld_mbrain_0
					owner = owner
					planet = star
				}
				save_event_target_as = giga_system
			}

			if = {
				limit = { exists = owner }
				owner = {
					country_event = {
						id = xhk_voidframe_notif.002
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}





#aetheromirror
xhk_voidframe_add_dsst0 = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_add_dsst0

	prerequisites = {
		tech_sm_summon_gateway
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 2000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 750000
			sr_dark_matter = 50000
			acot_sr_dark_energy = 50000
			influence = 500
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_voidframe_dsst }
		custom_tooltip = {
			fail_text = "requires_no_existing_dsst"
			from = { NOT = { has_country_flag = built_dsst } }
		}
		has_sots = yes
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_ddst_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_dsst
			from = {
				solar_system = {
					save_event_target_as = dsst_system	#system
					set_star_flag = sm_dsst_explosion_source #system
					spawn_megastructure = {
						type = deep_shroud_summoning_threshold_0_xhk_dupl
						orbit_distance = 0 
						orbit_angle = 0
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
				set_country_flag = built_dsst	#country
			}
			save_event_target_as = sm_dsst #should be megastructure, but targets planet
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

#lathe
#45 deg, 60 dis
xhk_voidframe_add_cosmolathe = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_add_cosmolathe

	prerequisites = {
		tech_cosmogenesis_world
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 2000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 15000
			influence = 300
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_planet_flag = xhk_voidframe_cosmolathe }
		custom_tooltip = {
			fail_text = "requires_no_existing_cosmogenesis_world"
			from = {
				NOT = { has_country_flag = cosmogenesis_world_built }
			}
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}

	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_cosmolathe_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_cosmolathe
			from = { set_country_flag = cosmogenesis_world_built }
			from = {
				solar_system = {
					spawn_planet = {
						class = "pc_cosmogenesis_world"
						location = this.star
						orbit_location = yes
						orbit_angle_offset = 45
						orbit_distance_offset = 60
						plane_offset = 5
						size = 2
						has_ring = no
					
						init_effect = {
							set_name = {
								key = pc_cosmogenesis_world
							}
							set_planet_entity = {
								entity = "neural_calculator_phase_1_entity"
							}
							set_surveyed = {
								surveyed = yes
								surveyor = FROM
							}
							set_all_comms_surveyed = yes
							clear_blockers = yes
					
							set_planet_flag = megastructure
							set_planet_flag = cosmogenesis_world_resettle@from
					
							fromfrom.planet = {
								set_planet_flag = has_megastructure
								set_planet_flag = has_cosmogenesis_world
								if = {
									limit = { has_orbital_station = yes }
									orbital_station = {
										dismantle = yes
									}
								}
							}
					
							set_owner = fromfrom
							set_controller = fromfrom
							create_pop = {
								species = owner_main_species
							}
							from = {
								room_name_override = ""
							}
						}
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}

#psibeacon
#150 deg, 60 dis
xhk_voidframe_add_psibeacon = {
	owned_planets_only = yes
	icon = decision_xhk_voidframe_add_psibeacon

	prerequisites = {
		giga_tech_psychic_beacon
	}

	show_tech_unlock_if = {
		owner = { giga_has_frameworld_origin = yes }
	}

	enactment_time = 2000
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 100
			unity = @giga_giga_unity_cost
		}
	}
	
	potential = {
		exists = owner
		owner = {
			giga_has_frameworld_origin = yes
		}
		is_planet_class = pc_giga_frameworld
		NOT = { has_global_flag = psychic_beacon_disabled }
		NOT = { has_planet_flag = xhk_voidframe_psibeacon }
		OR = {
			check_variable = { which = giga_psychic_beacon_cap value = 0 }						# No Cap
			check_variable = { which = giga_current_psychic_beacon value < giga_psychic_beacon_cap }
		}
	}
	
	allow = {		
		has_major_upgraded_capital = yes
		custom_tooltip_fail = {
			not = {
				has_planet_flag = frameworld_upgrade
			}
			text = giga_frameworld_upgrade_fail
		}
	}
	
	effect = {
		custom_tooltip = giga_frameworld_upgrade_desc
		custom_tooltip = xhk_voidframe_add_psibeacon_effect

		hidden_effect = {
			set_planet_flag = xhk_voidframe_psibeacon

			from = {
				change_variable = { which = giga_current_psychic_beacon value = 1 }
				solar_system = {
					spawn_megastructure = {
						type = psychic_beacon_1
						orbit_distance = 60 
						orbit_angle = 150
						planet = this.star
						owner = space_owner
						graphical_culture = owner
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 10
	}
}




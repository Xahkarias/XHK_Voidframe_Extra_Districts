# this is a low priority override

# Market Candidate Nomination
decision_market_nomination = {
    owned_planets_only = yes

    # instant

    resources = {
        category = decisions
        cost = {
            energy = 1000
            influence = 150
        }
    }

    potential = {
        OR = {
            has_global_flag = ongoing_market_nomination
            has_global_flag = ongoing_market_relocation_nomination
        }
        #from = { has_communications = event_target:50percentcomms } # should include self
        exists = from
        from = {
            has_country_flag = market_nomination_eligible
            NOT = { has_valid_civic = civic_inwards_perfection }
            OR = {
                is_ai = no
                NOT = { has_ethic = ethic_fanatic_xenophobe }
            }
        }
        NOT = { has_designation = col_nanotech_world }
    }

    allow = {
        from = { pop_amount > 2000 }
        custom_tooltip = {
            fail_text = already_market_nominated
            from = {
                NOT = {
                    any_owned_planet = {
                        OR = {
                            has_modifier = market_nominee_level_1
                            has_modifier = market_nominee_level_2
                            has_modifier = market_nominee_level_3
                            has_modifier = market_nominee_level_4 # boosted once
                            has_modifier = market_nominee_level_5 # boosted twice
                        }
                    }
                }
            }
        }
    }

    effect = {
        custom_tooltip = decision_market_nomination_effects
        hidden_effect = {
            from = {
                set_variable = {
                    which = market_rating
                    value = 0
                }
            }
            random_list = {
                9 = {
                    add_modifier = {
                        modifier = market_nominee_level_1
                        days = -1
                    }
                    from = {
                        change_variable = {
                            which = market_rating
                            value = 1
                        }
                    }
                    modifier = {
                        factor = 0.33
                        from = { is_megacorp = yes }
                    }
                    modifier = {
                        factor = 0.5
                        planet_resource_compare = {
                            resource = trade
                            value >= 120
                            type = produces
                        }
                    }
                    modifier = {
                        factor = 0.5
                        planet_resource_compare = {
                            resource = trade
                            value >= 80
                            type = produces
                        }
                    }
                    modifier = {
                        factor = 2
                        planet_resource_compare = {
                            resource = trade
                            value < 50
                            type = produces
                        }
                    }
                    modifier = {
                        factor = 1.5
                        from = { has_ethic = ethic_gestalt_consciousness }
                    }
                }
                6 = {
                    add_modifier = {
                        modifier = market_nominee_level_2
                        days = -1
                    }
                    from = {
                        change_variable = {
                            which = market_rating
                            value = 2
                        }
                    }
                }
                1 = {
                    modifier = {
                        factor = 200
                        is_planet_class = pc_city
                    }
                    modifier = { # XHK EDIT
                        factor = 100
                        is_planet_class = pc_giga_frameworld
                    }
                    modifier = {
                        factor = 9
                        from = { is_megacorp = yes }
                    }
                    modifier = {
                        factor = 2
                        planet_resource_compare = {
                            resource = trade
                            value >= 120
                            type = produces
                        }
                    }
                    modifier = {
                        factor = 1.5
                        planet_resource_compare = {
                            resource = trade
                            value >= 80
                            type = produces
                        }
                    }
                    modifier = {
                        factor = 0.5
                        planet_resource_compare = {
                            resource = trade
                            value < 50
                            type = produces
                        }
                    }
                    modifier = {
                        factor = 0.5
                        from = { has_ethic = ethic_gestalt_consciousness }
                    }
                    add_modifier = {
                        modifier = market_nominee_level_3
                        days = -1
                    }
                    from = {
                        change_variable = {
                            which = market_rating
                            value = 3
                        }
                    }
                }
            }
        }
    }

    ai_weight = {
        weight = 10
        modifier = {
            factor = 0
            pop_amount < 2000
        }
        modifier = {
            factor = 1.5
            from = {
                resource_stockpile_compare = {
                    resource = energy
                    value > 12000
                }
                resource_stockpile_compare = {
                    resource = influence
                    value > 400
                }
            }
        }
        modifier = {
            factor = 0.8
            from = { is_xenophobe = yes }
        }
        modifier = {
            factor = 2
            from = { is_megacorp = yes }
        }
        modifier = {
            factor = 2
            planet_resource_compare = {
                resource = trade
                value >= 120
                type = produces
            }
        }
        modifier = {
            factor = 1.5
            planet_resource_compare = {
                resource = trade
                value >= 80
                type = produces
            }
        }
        modifier = {
            factor = 0.5
            planet_resource_compare = {
                resource = trade
                value < 50
                type = produces
            }
        }
    }
}